{
  "hash": "253635d7d520d66fd2f1711a9db9cdc6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"HW 06 - Money in US politics\"\noutput: \n  tufte::tufte_html:\n    css: ../hw.css\n    tufte_variant: \"envisioned\"\n    highlight: pygments\nlink-citations: true\n---\n\n\n\n::: {.cell fig.margin='true'}\n::: {.cell-output-display}\n![Photo by Sharon McCutcheon on Unsplash](img/sharon-mccutcheon-rItGZ4vquWk-unsplash.jpg){width=80%}\n:::\n:::\n\n\nEvery election cycle brings its own brand of excitement -- and lots of money.\nPolitical donations are of particular interest to political scientists and other researchers studying politics and voting patterns.\nThey are also of interest to citizens who want to stay informed of how much money their candidates raise and where that money comes from.\n\nIn the United States, *\"only American citizens (and immigrants with green cards) can contribute to federal politics, but the American divisions of foreign companies can form political action committees (PACs) and collect contributions from their American employees.\"*[^hw-06-money-in-politics-1]\n\nIn this assignment we will scrape and work with data foreign connected PACs that donate to US political campaigns.\nFirst, we will get data foreign connected PAC contributions in the 2022 election cycle.\nThen, you will use a similar approach to get data such contributions from previous years so that we can examine trends over time.\n\nIn order to complete this assignment you will need a Chrome browser with the [Selector Gadget extension](http://selectorgadget.com/) installed.\n\n# Getting started\n\nGo to the course GitHub organization and locate your homework repo, clone it in RStudio and open the R Markdown document.\nKnit the document to make sure it compiles without errors.\n\n## Warm up\n\nBefore we introduce the data, let's warm up with some simple exercises.\nUpdate the YAML of your R Markdown file with your information, knit, commit, and push your changes.\nMake sure to commit with a meaningful commit message.\nThen, go to your repo on GitHub and confirm that your changes are visible in your Rmd **and** md files.\nIf anything is missing, commit and push again.\n\n## Packages\n\nWe'll use the **tidyverse** package for much of the data wrangling and visualisation, the **robotstxt** package to check if we're allowed to scrape the data, the **rvest** package for data scraping, and the **scales** package for better formatting of labels on visualisations.\nThese packages are already installed for you.\nYou can load them by running the following in your Console:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(robotstxt)\nlibrary(rvest)\nlibrary(scales)\n```\n:::\n\n\n## Data\n\nThis assignment does not come with any prepared datasets.\nInstead you'll be scraping the data!\n\n# Exercises\n\n## Data collection via web scraping\n\n\n::: {.cell fig.margin='true'}\n::: {.cell-output-display}\n![](img/opensecrets.png){width=80%}\n:::\n:::\n\n\nThe data come from [OpenSecrets.org](https://www.opensecrets.org), a *\"website tracking the influence of money on U.S. politics, and how that money affects policy and citizens' lives\"*.\nThis website is hosted by The Center for Responsive Politics, which is a nonpartisan, independent nonprofit that *\"tracks money in U.S. politics and its effect on elections and public policy.\"*[^hw-06-money-in-politics-2]\n\nBefore getting started, let's check that a bot has permissions to access pages on this domain.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(robotstxt)\npaths_allowed(\"https://www.opensecrets.org\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n\nOur goal is to scrape data for contributions in all election years Open Secrets has data for.\nSince that means repeating a task many times, let's first write a function that works on the first page.\nConfirm it works on a few others.\nThen iterate it over pages for all years.\n\n::: box\nComplete the following set of steps in the `scrape-pac.R` file in the `scripts` folder of your repository.\nThis file already contains some starter code to help you out.\n:::\n\n-   Write a function called `scrape_pac()` that scrapes information from the Open Secrets webpage for foreign-connected PAC contributions in a given year.\n    This function should\n\n    -   have one input: the URL of the webpage and should return a data frame.\n    -   rename variables scraped, using `snake_case` naming.\n    -   clean up the `Country of Origin/Parent Company` variable with `str_squish()`.\n    -   add a new column to the data frame for `year`. We will want this information when we ultimately have data from all years, so this is a good time to keep track of it. Our function doesn't take a year argument, but the year is embedded in the URL, so we can extract it out of there, and add it as a new column. Use the `str_sub()` function to extract the last 4 characters from the URL. You will probably want to look at the help for this function to figure out how to specify \"last 4 characters\".\n\n-   Define the URLs for 2022, 2020, and 2000 contributions.\n    Then, test your function using these URLs as inputs.\n    Does the function seem to do what you expected it to do?\n\n-   Construct a vector called `urls` that contains the URLs for each webpage that contains information on foreign-connected PAC contributions for a given year.\n\n-   Map the `scrape_pac()` function over `urls` in a way that will result in a data frame called `pac_all`.\n\n-   Write the data frame to a csv file called `pac-all.csv` in the `data` folder.\n\n*‚úÖ‚¨ÜÔ∏è If you haven't yet done so, now is definitely a good time to commit and push your changes to GitHub with an appropriate commit message (e.g. \"Data scraping complete\"). Make sure to commit and push all changed files so that your Git pane is cleared up afterwards.*\n\n<div>\n\nComplete the following set of steps in the `hw-06.Rmd` file in your repository.\n\n</div>\n\n1.  In your R Markdown file, load `pac-all.csv` and report its number of observations and variables using inline code.\n\n## Data cleaning\n\nIn this section we clean the `pac_all` data frame to prepare it for analysis and visualization.\nWe have two goals in data cleaning:\n\n-   Separate the `country_parent` into two such that country and parent company appear in different columns for country-level analysis.\n\n-   Convert contribution amounts in `total`, `dems`, and `repubs` from character strings to numeric values.\n\nThe following exercises walk you through how to make these fixes to the data.\n\n2.  Use the `separate()` function to separate `country_parent` into `country` and `parent` columns.\n    Note that country and parent company names are separated by `\\` (which will need to be specified in your function) and also note that there are some entries where the `\\` sign appears twice and in these cases we want to only split the value at the first occurrence of `\\`.\n    This can be accomplished by setting the `extra` argument in to `\"merge\"` so that the cell is split into only 2 segments, e.g. we want `\"Denmark/Novo Nordisk A/S\"` to be split into `\"Denmark\"` and `\"Novo Nordisk A/S\"`.\n    (See help for `separate()` for more on this.) End your code chunk by printing out the top 10 rows of your data frame (if you just type the data frame name it should automatically do this for you).\n\n3.  Remove the character strings including `$` and `,` signs in the `total`, `dems`,and `repubs` columns and convert these columns to numeric.\n    End your code chunk by printing out the top 10 rows of your data frame (if you just type the data frame name it should automatically do this for you).\n    A couple hints to help you out:\n\n    -   The `$` character is a special character so it will need to be escaped.\n\n    -   Some contribution amounts are in the millions (e.g. Anheuser-Busch contributed a total of \\$1,510,897 in 2008).\n        In this case we need to remove all occurrences of `,`, which we can do by using `str_remove_all()` instead of `str_remove()`.\n\nüß∂ ‚úÖ ‚¨ÜÔ∏è *Now is a good time to knit your document, commit, and push your changes to GitHub with an appropriate commit message. Make sure to commit and push all changed files so that your Git pane is cleared up afterwards.*\n\n## Data visualization and interpretation\n\n4.  Create a line plot of total contributions from all foreign-connected PACs in the Canada and Mexico over the years.\n    Once you have made the plot, write a brief interpretation of what the graph reveals.\n    Few hints to help you out:\n\n    -   Filter for only `Canada` and `Mexico`.\n    -   Calculate sum of total contributions from PACs for each year for each country by using a sequence of `group_by()` then `summarise()`.\n    -   Make a plot of total contributions (y-axis) by year (x-axis) where two lines identified by different colours represent each of Canada and Mexico.\n\n\n::: {.cell}\n\n```{.marginfigure .cell-code}\n**Note:** The figure you create might look slightly different than this one if the data on the website has been updated recently.\n```\n:::\n\n\n4.  Recreate the following visualisation. Once you have made the plot, write a brief interpretation of what the graph reveals. Note that these are only UK contributions. You will need to make use of functions from the **scales** package for axis labels as well as from **ggplot2**.\n\n\n::: {.cell fig.fullwidth='true'}\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n‚Ñπ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](hw-06-money-in-politics_files/figure-html/unnamed-chunk-3-1.png){width=80%}\n:::\n:::\n\n\nüß∂ ‚úÖ ‚¨ÜÔ∏è Knit, *commit, and push your changes to GitHub with an appropriate commit message. Make sure to commit and push all changed files so that your Git pane is cleared up afterwards and review the md document on GitHub to make sure you're happy with the final state of your work.*\n\n[^hw-06-money-in-politics-1]: Source: [Open Secrets - Foreign Connected PACs](https://www.opensecrets.org/political-action-committees-pacs/foreign-connected-pacs).\n\n[^hw-06-money-in-politics-2]: Source: [Open Secrets - About](https://www.opensecrets.org/about/).\n",
    "supporting": [
      "hw-06-money-in-politics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}